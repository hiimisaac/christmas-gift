<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>üéÅ</title>
  <meta name="theme-color" content="#070A12" />

  <style>
    :root{
      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);

      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --hair: rgba(255,255,255,.10);

      --glassA: rgba(255,255,255,.07);
      --glassB: rgba(255,255,255,.05);

      --shadow: 0 24px 70px rgba(0,0,0,.55);
      --radius: 22px;

      /* tasteful, Apple-ish */
      --gold: 214, 180, 106;
      --mint: 126, 215, 193;
    }

    *{ box-sizing:border-box; }
    html{ height:100%; }
    body{
      margin:0;
      min-height:100%;
      color: var(--text);
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, system-ui;
      -webkit-font-smoothing: antialiased;
      overflow-x:hidden;
      overflow-y:auto;

      /* Smooth blend (no hard stop) */
      background:
        radial-gradient(1200px 800px at 18% 12%, rgba(var(--gold), .22), transparent 65%),
        radial-gradient(1100px 900px at 88% 28%, rgba(var(--mint), .18), transparent 62%),
        radial-gradient(900px 700px at 50% 115%, rgba(255,255,255,.07), transparent 60%),
        linear-gradient(180deg, #05070f 0%, #081021 55%, #060914 100%);
      background-color:#05070f;
    }

    /* Soft bloom to hide banding + add ‚Äúdepth‚Äù */
    body::after{
      content:"";
      position:fixed; inset:-40px;
      pointer-events:none;
      background:
        radial-gradient(900px 500px at 30% 5%, rgba(var(--gold), .16), transparent 70%),
        radial-gradient(900px 600px at 85% 15%, rgba(var(--mint), .12), transparent 72%);
      filter: blur(28px);
      opacity:.75;
      z-index:0;
    }

    /* subtle grain */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.08;
      z-index:1;
    }

    /* sparkles (subtle) */
    canvas{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 6;
    }

    main{
      position:relative;
      z-index: 10;
      max-width: 560px;
      margin: 0 auto;
      padding:
        calc(26px + var(--safeTop))
        16px
        calc(22px + var(--safeBottom));
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.085), rgba(255,255,255,.045));
      border: 1px solid var(--hair);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      overflow:hidden;
    }
    .inner{
      padding: 24px;
    }
    @media (min-width: 420px){
      .inner{ padding: 28px; }
    }

    h1{
      margin: 0 0 10px;
      font-size: clamp(28px, 7.2vw, 44px);
      letter-spacing: -0.7px;
      line-height: 1.05;
      font-weight: 760;
    }
    .lead{
      margin: 0 0 18px;
      color: var(--muted);
      font-size: clamp(14.5px, 4.2vw, 17px);
      line-height: 1.55;
    }

    .divider{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent);
      margin: 18px 0;
    }

    /* Slide control (premium) */
    .sliderWrap{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 14px;
    }

    .track{
      position:relative;
      height: 56px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
    }

    .track::before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(520px 160px at 18% 40%, rgba(255,255,255,.14), transparent 60%);
      transform: rotate(-8deg);
      opacity:.55;
      pointer-events:none;
    }

    .trackLabel{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      color: rgba(255,255,255,.70);
      font-weight: 650;
      letter-spacing: .2px;
      font-size: 15px;
      pointer-events:none;
      transition: opacity .15s ease;
    }

    .fill{
      position:absolute;
      left:0; top:0; bottom:0;
      width: var(--fill, 0%);
      background: linear-gradient(
        90deg,
        rgba(var(--gold), .30),
        rgba(var(--mint), .22)
      );
    }

    .thumb{
      position:absolute;
      top: 7px;
      left: 7px;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
      box-shadow: 0 12px 22px rgba(0,0,0,.35), inset 0 0 0 1px rgba(0,0,0,.10);
      display:grid;
      place-items:center;
      color: rgba(0,0,0,.70);
      font-size: 18px;
      transform: translateX(var(--x, 0px));
      transition: transform .18s ease-out;
    }
    .dragging .thumb{ transition:none; }

    /* Reveal */
    .reveal{
      display:none;
      margin-top: 18px;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      animation: rise .55s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes rise{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .reveal h2{
      margin:0 0 6px;
      font-size: clamp(18px, 5.6vw, 24px);
      letter-spacing: -0.25px;
      font-weight: 740;
    }
    .reveal p{
      margin:0;
      color: var(--muted);
      line-height: 1.5;
      font-size: 14.5px;
    }

    .audioRow{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .audioStatus{
      color: rgba(255,255,255,.65);
      font-size: 12.5px;
      line-height: 1.35;
      flex: 1 1 230px;
    }
    .playBtn{
      display:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 650;
      letter-spacing: .2px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .playBtn:active{ transform: scale(.99); }

    .details{
      display:none;
      margin-top: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-size: 14.5px;
    }
    .row:last-child{ border-bottom:none; }
    .k{ color: rgba(255,255,255,.55); min-width:72px; }
    .v{ text-align:right; color: rgba(255,255,255,.90); }
    .v small{ display:block; color: rgba(255,255,255,.60); margin-top:2px; }

    .foot{
      margin-top: 14px;
      text-align:center;
      color: rgba(255,255,255,.45);
      font-size: 12px;
      line-height: 1.35;
    }

    @media (prefers-reduced-motion: reduce){
      .reveal{ animation:none; }
      .thumb{ transition:none; }
    }
  </style>
</head>

<body>
  <canvas id="spark"></canvas>

  <main>
    <section class="card">
      <div class="inner">
        <!-- Nothing hinty -->
        <h1>For you.</h1>
        <p class="lead">Open when you‚Äôre ready.</p>

        <div class="divider"></div>

        <div class="sliderWrap" id="sliderWrap">
          <div class="track" id="track" role="button" aria-label="Slide to open">
            <div class="fill" id="fill"></div>
            <div class="trackLabel" id="trackLabel">Slide to open</div>
            <div class="thumb" id="thumb">‚Ä∫</div>
          </div>

          <!-- Empty until unlock (prevents guessing / view-source spoilers) -->
          <div class="reveal" id="reveal"></div>

          <div class="foot" id="foot" style="display:none;">If audio doesn‚Äôt start, tap Play once.</div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ---- Subtle sparkle burst
    const sparkCanvas = document.getElementById("spark");
    const sctx = sparkCanvas.getContext("2d");
    let sparks = [];

    function resizeSpark(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      sparkCanvas.width = Math.floor(window.innerWidth * dpr);
      sparkCanvas.height = Math.floor(window.innerHeight * dpr);
      sparkCanvas.style.width = window.innerWidth + "px";
      sparkCanvas.style.height = window.innerHeight + "px";
      sctx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener("resize", resizeSpark);
    resizeSpark();

    function burstSparks(){
      const cx = window.innerWidth * 0.5;
      const cy = Math.min(window.innerHeight * 0.26, 240);
      const palette = [
        "rgba(214,180,106,.95)",
        "rgba(126,215,193,.90)",
        "rgba(255,255,255,.85)"
      ];
      const count = 110;

      for (let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const sp = 1.6 + Math.random()*4.6;
        sparks.push({
          x: cx, y: cy,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp - 2.2,
          r: 1 + Math.random()*2.2,
          g: 0.08 + Math.random()*0.10,
          life: 85 + Math.random()*55,
          c: palette[i % palette.length]
        });
      }
    }

    function drawSparks(){
      sctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      for (let i=sparks.length-1;i>=0;i--){
        const p = sparks[i];
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 1;

        sctx.beginPath();
        sctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        sctx.fillStyle = p.c;
        sctx.globalAlpha = Math.max(0, Math.min(1, p.life/120));
        sctx.fill();

        if (p.life <= 0 || p.y > window.innerHeight + 60) sparks.splice(i,1);
      }
      sctx.globalAlpha = 1;
      requestAnimationFrame(drawSparks);
    }
    drawSparks();

    // ---- Slider
    const track = document.getElementById("track");
    const thumb = document.getElementById("thumb");
    const fill = document.getElementById("fill");
    const trackLabel = document.getElementById("trackLabel");
    const reveal = document.getElementById("reveal");
    const foot = document.getElementById("foot");

    let dragging = false;
    let startX = 0;
    let x = 0;
    let unlocked = false;

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function metrics(){
      const r = track.getBoundingClientRect();
      const maxX = (r.width - 14 - 42); // (left+right padding ~14) + thumb width
      return { r, maxX };
    }
    function setX(px){
      x = px;
      thumb.style.setProperty("--x", x + "px");
      const { maxX } = metrics();
      const pct = clamp((x / maxX) * 100, 0, 100);
      fill.style.width = pct + "%";
      trackLabel.style.opacity = String(0.90 - pct/120);
    }

    function snapBack(){
      track.classList.remove("dragging");
      const start = x;
      const t0 = performance.now();
      const dur = 180;
      function step(now){
        const p = clamp((now - t0)/dur, 0, 1);
        const ease = 1 - Math.pow(1 - p, 3);
        setX(start * (1 - ease));
        if (p < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    // ---- Audio (iOS reliable pattern)
    const audioUrl = new URL("./good-day.mp3", window.location.href).toString();
    let audio = null;

    function primeAudio(){
      // Create/load on first touch so iOS is less cranky later
      if (audio) return;
      audio = new Audio(audioUrl);
      audio.preload = "auto";
      try { audio.load(); } catch {}
    }

    function tryPlayAudio(audioStatusEl, playBtnEl){
      if (!audio) primeAudio();

      // optimistic attempt
      let played = false;
      try{
        const p = audio.play();
        // promise path (modern safari)
        if (p && typeof p.then === "function"){
          p.then(() => { played = true; })
           .catch(() => {
             audioStatusEl.textContent = "Tap Play once.";
             playBtnEl.style.display = "inline-block";
           });
        } else {
          // non-promise path: verify shortly after
          setTimeout(() => {
            if (audio && audio.paused){
              audioStatusEl.textContent = "Tap Play once.";
              playBtnEl.style.display = "inline-block";
            }
          }, 250);
          played = true;
        }
      } catch {
        audioStatusEl.textContent = "Tap Play once.";
        playBtnEl.style.display = "inline-block";
      }

      // also show fallback if still paused after a moment
      setTimeout(() => {
        if (audio && audio.paused){
          audioStatusEl.textContent = "Tap Play once.";
          playBtnEl.style.display = "inline-block";
        }
      }, 450);

      return played;
    }

    function unlock(){
      if (unlocked) return;
      unlocked = true;

      const { maxX } = metrics();
      setX(maxX);
      track.classList.remove("dragging");
      trackLabel.textContent = "Opened";
      trackLabel.style.opacity = "0.9";

      burstSparks();

      // Inject EVERYTHING only now (no spoilers pre-swipe)
      reveal.innerHTML = `
        <h2>We‚Äôre going to see <span style="color: rgba(214,180,106,.95)">Forrest Frank</span>.</h2>
        <p>ü§ç</p>
        <div class="audioRow">
          <div class="audioStatus" id="audioStatus">Starting music‚Ä¶</div>
          <button class="playBtn" id="playBtn" type="button">Play</button>
        </div>
        <div class="details" id="details"></div>
      `;
      reveal.style.display = "block";
      foot.style.display = "block";

      const audioStatus = document.getElementById("audioStatus");
      const playBtn = document.getElementById("playBtn");
      const details = document.getElementById("details");

      details.innerHTML = `
        <div class="row">
          <div class="k">Venue</div>
          <div class="v"><b>Lenovo Center</b><small>Raleigh, NC</small></div>
        </div>
        <div class="row">
          <div class="k">Vibe</div>
          <div class="v">Good Day energy ‚ú®</div>
        </div>
      `;
      details.style.display = "block";

      // Play immediately on this unlock gesture
      playBtn.style.display = "none";
      tryPlayAudio(audioStatus, playBtn);

      playBtn.addEventListener("click", () => {
        audioStatus.textContent = "Starting music‚Ä¶";
        tryPlayAudio(audioStatus, playBtn);
      });

      setTimeout(() => reveal.scrollIntoView({ behavior:"smooth", block:"start" }), 180);
    }

    // Pointer events + touch fallback
    track.addEventListener("pointerdown", (e) => {
      if (unlocked) return;
      primeAudio();
      dragging = true;
      track.classList.add("dragging");
      track.setPointerCapture?.(e.pointerId);
      startX = e.clientX;
    });
    track.addEventListener("pointermove", (e) => {
      if (!dragging || unlocked) return;
      const { maxX } = metrics();
      setX(clamp(e.clientX - startX, 0, maxX));
    });
    function endDrag(){
      if (!dragging || unlocked) return;
      dragging = false;

      const { maxX } = metrics();
      const pct = x / maxX;
      if (pct > 0.92) unlock();
      else snapBack();
    }
    track.addEventListener("pointerup", endDrag);
    track.addEventListener("pointercancel", endDrag);

    // Touch fallback (some iOS builds behave better with this)
    track.addEventListener("touchstart", (e) => {
      if (unlocked) return;
      primeAudio();
      dragging = true;
      track.classList.add("dragging");
      startX = e.touches[0].clientX;
    }, { passive: true });

    track.addEventListener("touchmove", (e) => {
      if (!dragging || unlocked) return;
      const { maxX } = metrics();
      setX(clamp(e.touches[0].clientX - startX, 0, maxX));
    }, { passive: true });

    track.addEventListener("touchend", endDrag);

    // init
    setX(0);
  </script>
</body>
</html>
